<%
function getApiBasePath() {
  const kababCased = utils.toKababCase(utils.pluralize(entity.name));
  return `${config.apiBasePath}/${kababCased}`;
}

function presentField(field) {
  const presenter = utils.isEntityTypeField(field)
    ? `${utils.toTitleCase(field._type._entity.name)}Axios.present`
    : isDateTypeField(field)
    ? 'new Date'
    : 'INVALID';
  const onePresenter = `${presenter}(one.${field.name})`;
  if (utils.isArrayField(field)) {
    return `one.${field.name}.map(${presenter})`;
  }
  if (utils.isNullableField(field)) {
    return `one.${field.name} === null ? null : ${onePresenter}`;
  }
  return onePresenter;
}
-%>
<% if (!entity.internal) { -%>
import {
  <%= entity.strings.responseClass %>,
  <%= getManyResponseName() %>,
  <%= getOneResponseName() %>,
  <%_ if (entity.api && (hasGetOne() || hasUpdateOne() || hasDeleteOne())) { -%>
  <%= getGetOneParamsName() %>,
  <%_ } -%>
} from './<%= entity.strings.typePackage %>';
  <%_ entity.types.filter(utils.isPresentableEntityType).filter((type) => type.name !== entity.name).forEach((type) => { -%>
import <%= `${utils.toTitleCase(type.name)}Axios` %> from './<%= `${utils.toKababCase(type.name)}-axios` %>';
  <%_ }); -%>
  <%_ if (entity.api) { -%>
<%- config.axiosImport ?? "import axios from 'axios';" %>
    <%_ if (hasGetMany()) { -%>
import { toQueryString } from 'airext';
    <%_ } -%>
    <%_ if (hasGetMany() || hasCreateOne() || hasUpdateOne()) { -%>
import {
      <%_ if (hasGetMany()) { -%>
  <%= getGetManyQueryName() %>,
      <%_ } -%>
      <%_ if (hasCreateOne()) { -%>
  <%= getCreateOneBodyName() %>,
      <%_ } -%>
      <%_ if (hasUpdateOne()) { -%>
  <%= getUpdateOneBodyName() %>,
      <%_ } -%>
} from '<%= entity.api.request.import %>';
    <%_ } -%>
  <%_ } -%>

function present(one: any): <%= entity.strings.responseClass %> {
  return {
    ...one,
  <%_ entity.fields.filter(utils.isPresentableField).filter((field) => isDateTypeField(field) || utils.isEntityTypeField(field)).forEach((field) => { -%>
    ...(one.<%= field.name %> !== undefined && { <%= field.name %>: <%= presentField(field) %> }),
  <%_ }); -%>
  };
}

function presentManyResponse(response: any): <%= getManyResponseName() %> {
  const cursor = {
    ...response.cursor,
  <%_ entity.fields.filter(isDateTypeField).filter(isCursorField).forEach((field) => { -%>
    <%= getCursorFieldName(field, "min") %>: new Date(response.cursor.<%= getCursorFieldName(field, "min") %>),
    <%= getCursorFieldName(field, "max") %>: new Date(response.cursor.<%= getCursorFieldName(field, "max") %>),
  <%_ }); -%>
  };
  return { cursor, <%= getManyEntitiesVarName() %>: response.<%= getManyEntitiesVarName() %>.map(present) };
}

function presentOneResponse(response: any): <%= getOneResponseName() %> {
  return { <%= getOneEntityVarName() %>: present(response.<%= getOneEntityVarName() %>) };
}

  <%_ if (entity.api) { -%>
    <%_ if (hasGetMany()) { -%>

async function getMany(query: <%= getGetManyQueryName() %>): Promise<<%= getManyResponseName() %>> {
  const queryString = toQueryString(query);
  const pathSuffix = queryString.length ? `?${queryString}` : '';
  const path = `<%= getApiBasePath() %>${pathSuffix}`;
  const { data } = await axios.get(path);
  return presentManyResponse(data);
}
    <%_ } -%>
    <%_ if (hasGetOne()) { -%>

async function getOne(params: <%= getGetOneParamsName() %>): Promise<<%= getOneResponseName() %>> {
  const { <%= entity.api.keys.join(', ') %> } = params;
  const pathSuffix = `<%- entity.api.keys.map((key) => `\${${key}}` ).join('/') %>`;
  const path = `<%= getApiBasePath() %>/${pathSuffix}`;
  const { data } = await axios.get(path);
  return presentOneResponse(data);
}
    <%_ } -%>
    <%_ if (hasCreateOne()) { -%>

async function createOne(body: <%= getCreateOneBodyName() %>): Promise<<%= getOneResponseName() %>> {
  const path = '<%= getApiBasePath() %>';
  const { data } = await axios.post(path, body);
  return presentOneResponse(data);
}
    <%_ } -%>
    <%_ if (hasUpdateOne()) { -%>

async function updateOne(params: <%= getGetOneParamsName() %>, body: <%= getUpdateOneBodyName() %>): Promise<<%= getOneResponseName() %>> {
  const { <%= entity.api.keys.join(', ') %> } = params;
  const pathSuffix = `<%- entity.api.keys.map((key) => `\${${key}}` ).join('/') %>`;
  const path = `<%= getApiBasePath() %>/${pathSuffix}`;
  const { data } = await axios.put(path, body);
  return presentOneResponse(data);
}
    <%_ } -%>
    <%_ if (hasDeleteOne()) { -%>

async function deleteOne(params: <%= getGetOneParamsName() %>): Promise<<%= getOneResponseName() %>> {
  const { <%= entity.api.keys.join(', ') %> } = params;
  const pathSuffix = `<%- entity.api.keys.map((key) => `\${${key}}` ).join('/') %>`;
  const path = `<%= getApiBasePath() %>/${pathSuffix}`;
  const { data } = await axios.delete(path);
  return presentOneResponse(data);
}
    <%_ } -%>
  <%_ } -%>

  <%_ if (entity.deprecated) { -%>
/** @deprecated */
  <%_ } -%>
const <%= `${getSingularEntName()}Axios` %> = {
    <%_ if (entity.deprecated) { -%>
  /** @deprecated */
    <%_ } -%>
  present,
  <%_ if (!entity.internal) { -%>
    <%_ if (entity.deprecated) { -%>
  /** @deprecated */
    <%_ } -%>
  presentManyResponse,
    <%_ if (entity.deprecated) { -%>
  /** @deprecated */
    <%_ } -%>
  presentOneResponse,
  <%_ } -%>
  <%_ if (entity.api) { -%>
    <%_ if (hasGetMany()) { -%>
      <%_ if (entity.deprecated) { -%>
  /** @deprecated */
      <%_ } -%>
  getMany,
    <%_ } -%>
    <%_ if (hasGetOne()) { -%>
      <%_ if (entity.deprecated) { -%>
  /** @deprecated */
      <%_ } -%>
  getOne,
    <%_ } -%>
    <%_ if (hasCreateOne()) { -%>
      <%_ if (entity.deprecated) { -%>
  /** @deprecated */
      <%_ } -%>
  createOne,
    <%_ } -%>
    <%_ if (hasUpdateOne()) { -%>
      <%_ if (entity.deprecated) { -%>
  /** @deprecated */
      <%_ } -%>
  updateOne,
    <%_ } -%>
    <%_ if (hasDeleteOne()) { -%>
      <%_ if (entity.deprecated) { -%>
  /** @deprecated */
      <%_ } -%>
  deleteOne,
    <%_ } -%>
  <%_ } -%>
};

export default <%= `${getSingularEntName()}Axios` %>;
<% } -%>
